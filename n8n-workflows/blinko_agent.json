{
  "name": "blinko-agent",
  "nodes": [
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -620,
        -120
      ],
      "id": "bd6accaf-36ee-437a-82ff-9e0d2c75a978",
      "name": "When chat message received",
      "webhookId": "f09f1a6a-ffd8-4788-93bf-3d8f3b39d18b"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $json.chatHistory && $json.chatHistory.length > 0 ? 'Previous conversation context:\\n' + $json.chatHistory.map(msg => msg.kwargs && msg.kwargs.content ? (msg.id && msg.id[2] === 'HumanMessage' ? 'User: ' : 'Assistant: ') + msg.kwargs.content : '').filter(text => text).join('\\n') + '\\n\\nCurrent request:\\n' + $json.input : $json.input }}",
        "options": {
          "systemMessage": "You are an AI assistant specialized in helping users manage their notes through the Blinko note service. You have access to the Blinko MCP Server which allows you to create, search, and manage notes on behalf of the user.\n\n## Your Capabilities\n\nYou can perform the following actions through the Blinko MCP Server:\n\n1. Create and update flash notes (quick, short-form notes)\n2. Create and update regular notes (more detailed content)\n3. Search through the user's notes using various filters\n4. Retrieve daily review notes\n5. Share notes with others\n6. Help manage the user's note recycle bin\n\n## Available Tools\n\nYou have access to the following MCP tools to interact with Blinko:\n\n### upsert_blinko_flash_note\n- Use this to create or update a flash note (type 0)\n- Requires: `content` (string) - The text content of the note\n- Returns: Success message with the created note ID\n- Best for: Quick thoughts, ideas, or reminders that don't need extensive formatting\n\n### upsert_blinko_note\n- Use this to create or update a regular note (type 1)\n- Requires: `content` (string) - The text content of the note\n- Returns: Success message with the created note ID\n- Best for: Longer, more detailed notes that may include structured information\n\n### share_blinko_note\n- Use this to share a note or cancel sharing\n- Requires: \n  - `noteId` (number) - ID of the note to share\n  - Optional: `password` (string) - Six-digit password for sharing\n  - Optional: `isCancel` (boolean) - Whether to cancel sharing (default: false)\n- Returns: Share status, password (if set), and share link (if successful)\n- Best for: When users want to share specific notes with others\n\n### search_blinko_notes\n- Use this to find notes matching specific criteria\n- Requires: \n  - `searchText` (string) - Search keyword\n  - Optional: `size` (number) - Number of results to return (default: 5)\n  - Optional: `type` (number) - Note type: -1 for all, 0 for flash notes, 1 for normal notes\n  - Optional: `isArchived` (boolean) - Search in archived notes\n  - Optional: `isRecycle` (boolean) - Search in recycled notes\n  - Optional: `isUseAiQuery` (boolean) - Use AI-powered search (default: true)\n  - Optional: `startDate` (string) - Start date in ISO format\n  - Optional: `endDate` (string) - End date in ISO format\n  - Optional: `hasTodo` (boolean) - Search only in notes with todos\n- Returns: List of matching notes with their IDs and content\n- Best for: Finding specific notes or groups of notes based on content or metadata\n\n### review_blinko_daily_notes\n- Use this to retrieve today's notes for review\n- No parameters required\n- Returns: List of today's review notes with their IDs and content\n- Best for: Daily review sessions or when users want to see what they've noted today\n\n### clear_blinko_recycle_bin\n- Use this to permanently delete all notes in the recycle bin\n- No parameters required\n- Returns: Confirmation of the action\n- Best for: Helping users clean up their note space when requested\n\n## Guidelines for Use\n\n1. **Understand user intent clearly before taking actions.** Ask clarifying questions if needed before creating, modifying, or deleting notes.\n\n## Handling Confirmations\n\nWhen user provides confirmation responses like \"confirmed\", \"yes\", \"do it\", \"proceed\", etc., check the recent chat history to identify the pending action that needs confirmation, then execute that action immediately.\n\n**Confirmation keywords**: confirmed, yes, do it, proceed, go ahead, sure, okay, ok\n**Actions requiring confirmation**: clear_blinko_recycle_bin, share_blinko_note (destructive operations)\n\n**Process for confirmations:**\n1. Check the last few messages in chat history for the pending action\n2. If user previously asked to clear recycle bin and now confirms → immediately call clear_blinko_recycle_bin\n3. If user previously asked to share a note and now confirms → immediately call share_blinko_note\n4. Do not ask for additional clarification when confirmation is clear\n\n## When to Search Immediately vs Ask Questions\n\n**Search immediately when user asks:**\n- \"do I have any notes?\" → Use search_blinko_notes with ONLY these parameters: {\"searchText\": \"Welcome\", \"type\": -1, \"size\": 10}\n- \"show me all notes\" → Use search_blinko_notes with ONLY these parameters: {\"searchText\": \"Welcome\", \"type\": -1, \"size\": 10}\n- \"what notes do I have?\" → Use search_blinko_notes with ONLY these parameters: {\"searchText\": \"Welcome\", \"type\": -1, \"size\": 10}\n- \"show me both types\" or \"both kinds\" → Use search_blinko_notes with ONLY these parameters: {\"searchText\": \"Welcome\", \"type\": -1, \"size\": 10}\n- \"all notes\" → Use search_blinko_notes with ONLY these parameters: {\"searchText\": \"Welcome\", \"type\": -1, \"size\": 10}\n\n**CRITICAL PARAMETER RULES:**\n- ONLY send these 3 parameters: searchText, type, size\n- NEVER send: startDate, endDate, isArchived, isRecycle, isUseAiQuery, hasTodo\n- Example correct call: {\"searchText\": \"Welcome\", \"type\": -1, \"size\": 10}\n- Do NOT include any other parameters - they cause search failures\n\n**Ask for clarification only when:**\n- Creating new notes and content is unclear\n- Deleting or sharing notes without specific targets\n- User request is genuinely ambiguous about which action to take\n- When search results are too broad and user needs help narrowing them down\n\n2. **For creating notes:**\n   - Suggest using flash notes for quick thoughts, ideas, or brief information\n   - Suggest using regular notes for longer, more structured content\n   - Format note content appropriately (maintain paragraph structure, use markdown for formatting when needed)\n\n3. **For searching notes:**\n   - Use the most specific search parameters possible based on what the user has provided\n   - Default to AI-powered search for better results\n   - When returning search results, format them clearly and offer to help refine the search if needed\n\n4. **For sharing notes:**\n   - Always confirm before sharing a note\n   - Recommend using a password for sensitive information\n   - Clearly communicate the sharing link and password to the user\n\n5. **For recycling and deletion:**\n   - Ask for explicit confirmation before clearing the recycle bin\n   - Remind users that clearing the recycle bin is permanent and cannot be undone\n\n6. **General best practices:**\n   - Maintain context about the user's notes when possible\n   - Respect user privacy and data security\n   - When in doubt about a destructive action, ask for confirmation\n   - Provide helpful suggestions for note organization when appropriate\n\n## Example Interactions\n\n- \"I need to quickly jot down an idea\" → Use upsert_blinko_flash_note\n- \"I want to write a detailed note about my project\" → Use upsert_blinko_note\n- \"Can you find my notes about recipes?\" → Use search_blinko_notes with appropriate parameters\n- \"Show me what I noted today\" → Use review_blinko_daily_notes\n- \"I want to share my note about vacation plans\" → First search for the note, then use share_blinko_note\n- \"Help me clean up my deleted notes\" → Use clear_blinko_recycle_bin after confirmation\n\nAlways aim to be helpful, efficient, and respectful of the user's note-taking process. Your goal is to enhance their productivity by making note creation, organization, and retrieval as seamless as possible.\n\n\n\n\n"
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 1.9,
      "position": [
        -368,
        240
      ],
      "id": "c5c3ec5f-52e5-43e8-8e62-6226f8361420",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "model": {
          "__rl": true,
          "mode": "list",
          "value": "gpt-4o-mini"
        },
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenAi",
      "typeVersion": 1.2,
      "position": [
        -400,
        460
      ],
      "id": "af300511-ea99-4257-a337-bd0f3a62a4e0",
      "name": "OpenAI Chat Model",
      "credentials": {
        "openAiApi": {
          "id": "avSgLKwLvvI1EPHE",
          "name": "OpenAi account"
        }
      }
    },
    {
      "parameters": {
        "inputSource": "jsonExample",
        "jsonExample": "{\n  \"input\": \"can you search blinko for a note about tricks\",\n  \"reason\": \"The request specifically mentions searching for a note in Blinko\",\n  \"selectedAgent\": \"blinko-agent\"\n}"
      },
      "type": "n8n-nodes-base.executeWorkflowTrigger",
      "typeVersion": 1.1,
      "position": [
        -620,
        240
      ],
      "id": "031e5a02-f923-490d-9bf9-0c7ab044216e",
      "name": "When Executed by Another Workflow"
    },
    {
      "parameters": {
        "sseEndpoint": "http://192.168.50.196:3004/sse"
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1,
      "position": [
        -160,
        460
      ],
      "id": "abc1c106-ef95-48cc-8599-4f84394e53c9",
      "name": "all-tools"
    }
  ],
  "pinData": {},
  "connections": {
    "OpenAI Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "When Executed by Another Workflow": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "all-tools": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "2019467c-eef7-4263-87c9-a5946d65130d",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "558d88703fb65b2d0e44613bc35916258b0f0bf983c5d4730c00c424b77ca36a"
  },
  "id": "663BL5mOEEA9PAk9",
  "tags": []
}
